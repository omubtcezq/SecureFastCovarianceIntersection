%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%%   Identification
%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{BNPackages/BNMathEstimation}[2019/11/12 BN Mathe Macros Estimation]

% Changes 2019/11/12
% * created


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%%   Preliminary declarations
%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage{BNPackages/BNMathMacros} %
\RequirePackage{xparse}

%------------------------------------------------------------
% Helper Definitions
%------------------------------------------------------------

\NewDocumentCommand{\VEC}{m s o d()} {%
	\ensuremath{%
	\IfBooleanTF{#2}{#1}{\vec{#1}}\IfNoValueF{#3}{_{#3}}\IfNoValueF{#4}{^{#4}}%
	}%
}

\NewDocumentCommand{\RVEC}{m s o d()} {%
	\ensuremath{%
	\IfBooleanTF{#2}{\rv{#1}}{\rvec{#1}}\IfNoValueF{#3}{_{#3}}\IfNoValueF{#4}{^{#4}}%
	}%
}

\NewDocumentCommand{\MVEC}{m s o d()} {%
	\ensuremath{%
	\IfBooleanTF{#2}{\hat{\rv{#1}}}{\mvec{#1}}\IfNoValueF{#3}{_{#3}}\IfNoValueF{#4}{^{#4}}%
	}%
}

\NewDocumentCommand{\MAT}{m o d()} {%
	\ensuremath{%
	\mat{#1}\IfNoValueF{#2}{_{#2}}\IfNoValueF{#3}{^{#3}}%
	}%
}


%------------------------------------------------------------
% Time Steps
%------------------------------------------------------------

\newcommand{\tinit}{{0 \vert 0}}% 		0|0
\newcommand{\tkk}{{k \vert k}}% 			k|k
\newcommand{\tnkk}{{k+1 \vert k}}% 		k+1|k
\newcommand{\tnknk}{{k+1 \vert k+1}}% 	k-1|k-1
\newcommand{\tkpk}{{k \vert k-1}}% 		k|k-1
\newcommand{\tpkpk}{{k-1 \vert k-1}}% 	k-1|k-1

%------------------------------------------------------------
% Estimation - Vectors
%------------------------------------------------------------

% Usage \est*[sub](super){var}
% *: scalar
% []: subscript
% (): superscript
% {}: change variable (for some commands)

\NewDocumentCommand{\est} {s o d() g} {%
	\ensuremath{%
		% \IfBooleanTF{#1}%
		% {\MVEC{x}*}%
		% {\MVEC{x}}[#2](#3)%
		\IfBooleanF{#1}{\mvec}% 	scalar or vector
		{\IfNoValueTF{#4}{x}{#4}}%	change variable
		\IfNoValueF{#2}{_{#2}}% 	subscript
		\IfNoValueF{#3}{^{#3}}% 	superscript	
	}%
}

\NewDocumentCommand{\state} {s o d() g} {%
	\ensuremath{%
		% \IfBooleanTF{#1}%
		% {\RVEC{x}*}%
		% {\RVEC{x}}[#2](#3)%
		\IfBooleanTF{#1}{\rv}{\rvec}% 	scalar or vector
		{\IfNoValueTF{#4}{x}{#4}}%		change variable
		\IfNoValueF{#2}{_{#2}}% 		subscript
		\IfNoValueF{#3}{^{#3}}% 		superscript	
	}%
}

\NewDocumentCommand{\inp} {s o d()} {%
	\ensuremath{%
		% \IfBooleanTF{#1}%
		% {\RVEC{u}*}%
		% {\RVEC{u}}[#2](#3)%
		\IfBooleanTF{#1}{\rv}{\rvec}u% 	scalar or vector
		\IfNoValueF{#2}{_{#2}}% 		subscript
		\IfNoValueF{#3}{^{#3}}% 		superscript			
	}%
}

\NewDocumentCommand{\sysnoise} {s o d()} {%
	\ensuremath{%
		\IfBooleanTF{#1}{\rv}{\rvec}w% 	scalar or vector
		\IfNoValueF{#2}{_{#2}}% 		subscript
		\IfNoValueF{#3}{^{#3}}% 		superscript			
	}%
}

\NewDocumentCommand{\meas} {s o d()} {%
	\ensuremath{%
		% \IfBooleanTF{#1}%
		% {\RVEC{z}*}%
		% {\RVEC{z}}[#2](#3)%
		\IfBooleanTF{#1}{\rv}{\rvec}z% 	scalar or vector
		\IfNoValueF{#2}{_{#2}}% 		subscript
		\IfNoValueF{#3}{^{#3}}% 		superscript			
	}%
}

\NewDocumentCommand{\measnoise} {s o d()} {%
	\ensuremath{%
		% \IfBooleanTF{#1}%
		% {\RVEC{v}*}%
		% {\RVEC{v}}[#2](#3)%
		\IfBooleanTF{#1}{\rv}{\rvec}v% 	scalar or vector
		\IfNoValueF{#2}{_{#2}}% 		subscript
		\IfNoValueF{#3}{^{#3}}% 		superscript			
	}%
}

\NewDocumentCommand{\erstoc} {s o d() g} {%
	\ensuremath{%
		% \IfBooleanF{#1}{\vec}{\tilde{\boldsymbol{ \IfNoValueTF{#4}{x}{#4} }}}\IfNoValueF{#2}{_{#2}}\IfNoValueF{#3}{^{#3}}
		\IfBooleanF{#1}{\vec}{%
		\tilde{\boldsymbol{%
			\IfNoValueTF{#4}{x}{#4}%    change variable
		}}%	
		}% 	scalar or vector
		\IfNoValueF{#2}{_{#2}}% 		subscript
		\IfNoValueF{#3}{^{#3}}% 		superscript			
	}
}

%------------------------------------------------------------
% Estimation - Matrices
%------------------------------------------------------------

% *: scalar
% ~: round brackets
% []: subscript
% (): superscript


\NewDocumentCommand{\estcov} {s t~ o d()} {%
	\ensuremath{%
		\IfBooleanT{#2}{\bigl(}%		~: brackets
		\IfBooleanF{#1}{\mat}{P}%		*: scalar
		\IfNoValueF{#3}{_{#3}}%			[]: subscript
		\IfNoValueF{#4}{^{#4}}%			(): superscript
		\IfBooleanT{#2}{\bigr)}%		~: brackets end
	}
}

\NewDocumentCommand{\measmat} {s t~ o d()} {%
	\ensuremath{%
		\IfBooleanT{#2}{\bigl(}%		~: brackets
		\IfBooleanF{#1}{\mat}{C}%		*: scalar
		\IfNoValueF{#3}{_{#3}}%			[]: subscript
		\IfNoValueF{#4}{^{#4}}%			(): superscript
		\IfBooleanT{#2}{\bigr)}%		~: brackets end
	}%
}

\NewDocumentCommand{\sysmat} {s t~ o d()} {%
	\ensuremath{%
		\IfBooleanT{#2}{\bigl(}%		~: brackets
		\IfBooleanF{#1}{\mat}{A}%		*: scalar
		\IfNoValueF{#3}{_{#3}}%			[]: subscript
		\IfNoValueF{#4}{^{#4}}%			(): superscript
		\IfBooleanT{#2}{\bigr)}%		~: brackets end
	}%
}

\NewDocumentCommand{\inpmat} {s t~ o d()} {%
	\ensuremath{%
		\IfBooleanT{#2}{\bigl(}%		~: brackets
		\IfBooleanF{#1}{\mat}{B}%		*: scalar
		\IfNoValueF{#3}{_{#3}}%			[]: subscript
		\IfNoValueF{#4}{^{#4}}%			(): superscript
		\IfBooleanT{#2}{\bigr)}%		~: brackets end
	}%
}

\NewDocumentCommand{\meascov} {s t~ o d()} {%
	\ensuremath{%
		\IfBooleanT{#2}{\bigl(}%		~: brackets
		\IfBooleanF{#1}{\mat}{R}%		*: scalar
		\IfNoValueF{#3}{_{#3}}%			[]: subscript
		\IfNoValueF{#4}{^{#4}}%			(): superscript
		\IfBooleanT{#2}{\bigr)}%		~: brackets end
	}%
}

\NewDocumentCommand{\syscov} {s t~ o d()} {%
	\ensuremath{%
		\IfBooleanT{#2}{\bigl(}%		~: brackets
		\IfBooleanF{#1}{\mat}{Q}%		*: scalar
		\IfNoValueF{#3}{_{#3}}%			[]: subscript
		\IfNoValueF{#4}{^{#4}}%			(): superscript
		\IfBooleanT{#2}{\bigr)}%		~: brackets end
	}%
}

\NewDocumentCommand{\gain} {s t~ o d() g} {%
	\ensuremath{%
		\IfBooleanT{#2}{\bigl(}%		~: brackets
		\IfBooleanF{#1}{\mat}{%		*: scalar
		\IfNoValueTF{#5}{K}{#5}}%    	{}: change variable		
		\IfNoValueF{#3}{_{#3}}%			[]: subscript
		\IfNoValueF{#4}{^{#4}}%			(): superscript
		\IfBooleanT{#2}{\bigr)}%		~: brackets end		
	}
}